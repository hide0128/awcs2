# アーキテクチャドキュメント

## システム概要

AWS Credential Scanner Demoは、クライアントサイドのみで動作するシングルページアプリケーション（SPA）です。サーバーサイドの処理は不要で、すべての処理がブラウザ内で完結します。

## アーキテクチャ図

```
┌─────────────────────────────────────────┐
│         ユーザーインターフェース          │
│         (index.html + style.css)        │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│        アプリケーションロジック          │
│            (script.js)                  │
├─────────────────────────────────────────┤
│ - イベントハンドラー                     │
│ - スキャンエンジン                       │
│ - マスク処理                             │
│ - エクスポート機能                       │
│ - ファイルI/O                           │
└─────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│         ブラウザAPI                      │
├─────────────────────────────────────────┤
│ - FileReader API                        │
│ - Blob API                              │
│ - DOM API                               │
└─────────────────────────────────────────┘
```

## コンポーネント構造

### 1. UIレイヤー（index.html + style.css）

#### HTML構造
- **コンテナ**: `.container` - メインのコンテナ
- **入力エリア**: `#code-input` - コード入力用のテキストエリア
- **ボタングループ**: `.button-group` - アクションボタンの配置
- **結果表示エリア**: `#results-area` - スキャン結果の表示
- **隠しファイル入力**: `#file-input` - ファイル選択用の非表示要素

#### スタイリング
- レスポンシブデザイン
- グラデーションボタン
- ホバーエフェクト
- シャドウとボーダーラディウスでモダンなUI

### 2. アプリケーションロジックレイヤー（script.js）

#### 主要機能モジュール

##### A. スキャンエンジン
```javascript
// 正規表現パターン
accessKeyIdRegex = /(AKIA[0-9A-Z]{16})/g
secretAccessKeyRegex = /([0-9a-zA-Z\/\+\=]{40})/g
```

**動作フロー**:
1. コードを行単位で分割
2. 各行に対して正規表現でマッチング
3. アクセスキーID: `AKIA` + 16文字の英数字
4. シークレットアクセスキー: 40文字（行に'secret'または'key'を含む場合のみ）

##### B. 結果処理
```javascript
foundCredentials = [
  {
    type: 'Access Key ID' | 'Secret Access Key',
    value: string,
    lineNumber: number,
    index: number,
    originalLine: string
  }
]
```

##### C. マスク処理
- 降順ソート（行番号と位置で）により、複数マスクの正確性を保証
- 部分的な表示で元の形式を保持

##### D. エクスポート機能
- **CSV**: ヘッダー行 + データ行、ダブルクォートのエスケープ処理
- **JSON**: `JSON.stringify()` で整形出力（インデント2）

##### E. ファイルI/O
- **インポート**: FileReader APIで非同期読み込み
- **エクスポート**: Blob + URL.createObjectURL()でダウンロード

## データフロー

### スキャンフロー
```
ユーザー入力
  ↓
[スキャン実行ボタンクリック]
  ↓
コードの取得（textarea.value）
  ↓
行単位で分割
  ↓
各行に正規表現を適用
  ↓
マッチした認証情報を配列に格納
  ↓
結果のサマリー生成
  ↓
UIに表示（リスト + アクションボタン）
```

### マスクフロー
```
[認証情報をマスクボタンクリック]
  ↓
foundCredentials配列を降順ソート
  ↓
各認証情報に対して:
  - 該当行を特定
  - マスク文字列を生成
  - 行を置換
  ↓
textareaの内容を更新
  ↓
結果エリアにメッセージ表示
  ↓
ダウンロードボタンを表示
```

### エクスポートフロー
```
[エクスポートボタンクリック]
  ↓
データフォーマットに変換（CSV/JSON）
  ↓
Blob オブジェクト作成
  ↓
URL.createObjectURL()
  ↓
<a>要素を動的に作成してクリック
  ↓
ファイルダウンロード
```

## イベント駆動アーキテクチャ

### イベントリスナー

| イベント | トリガー | ハンドラー処理 |
|---------|---------|--------------|
| `DOMContentLoaded` | ページ読み込み完了 | 初期化、サンプルコード設定 |
| `click` (scanButton) | スキャン実行ボタン | スキャン処理実行 |
| `click` (generateButton) | ダミー認証情報作成 | ランダム認証情報生成 |
| `click` (importButton) | ファイルインポート | ファイル選択ダイアログ表示 |
| `change` (fileInput) | ファイル選択 | ファイル読み込み |
| `click` (maskButton) | 認証情報マスク | マスク処理実行 |
| `click` (exportButton) | CSV/JSONエクスポート | ファイルエクスポート |
| `click` (downloadMaskedButton) | マスク済みダウンロード | マスク済みファイルダウンロード |

## セキュリティ考慮事項

### クライアントサイドのみの処理
- すべての処理がブラウザ内で完結
- ネットワークリクエストなし
- データがサーバーに送信されることはない
- プライバシーとセキュリティを保護

### 正規表現の制限
- 誤検知の可能性あり（40文字の文字列はすべてマッチ）
- シークレットキーは行に'secret'または'key'を含む場合のみ検出
- より高度な検証には機械学習やコンテキスト分析が必要

## パフォーマンス考慮事項

### 最適化
- 同期処理（大きなファイルでは遅延の可能性）
- 行単位の処理で効率的
- DOMの直接操作を最小限に

### スケーラビリティの制限
- 非常に大きなファイルではブラウザがフリーズする可能性
- 推奨: 10,000行以下のファイル

## 拡張性

### 将来の改善案
1. **Web Workers**: バックグラウンド処理で大きなファイルに対応
2. **追加のパターン**: 他のクラウドプロバイダーの認証情報
3. **コンテキスト分析**: 誤検知の削減
4. **リアルタイムスキャン**: 入力中にスキャン
5. **設定オプション**: カスタム正規表現パターン
6. **統計情報**: スキャン履歴とトレンド分析

## 技術的負債

- エラーハンドリングの不足（特にファイル読み込み）
- ユニットテストの欠如
- TypeScriptへの移行検討
- モジュール化の改善（コードの分割）
